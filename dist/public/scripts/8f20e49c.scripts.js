"use strict";angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(a){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var b=a;return function(a,c,d,e){function f(a){return angular.isDefined(a)?(s(a),N?(k(),l(),!0):j()):j()}function g(a){angular.isDefined(a)&&(D=a,N&&w())}function h(a){return N?(G=o(a||""),I=n(G),e.$setValidity("mask",I),I&&G.length?p(G):void 0):a}function i(a){return N?(G=o(a||""),I=n(G),e.$viewValue=G.length?p(G):"",e.$setValidity("mask",I),""===G&&void 0!==e.$error.required&&e.$setValidity("required",!1),I?G:void 0):a}function j(){return N=!1,m(),angular.isDefined(P)?c.attr("placeholder",P):c.removeAttr("placeholder"),angular.isDefined(Q)?c.attr("maxlength",Q):c.removeAttr("maxlength"),c.val(e.$modelValue),e.$viewValue=e.$modelValue,!1}function k(){G=K=o(e.$modelValue||""),H=J=p(G),I=n(G);var a=I&&G.length?H:"";d.maxlength&&c.attr("maxlength",2*B[B.length-1]),c.attr("placeholder",D),c.val(a),e.$viewValue=a}function l(){O||(c.bind("blur",t),c.bind("mousedown mouseup",u),c.bind("input keyup click focus",w),O=!0)}function m(){O&&(c.unbind("blur",t),c.unbind("mousedown",u),c.unbind("mouseup",u),c.unbind("input",w),c.unbind("keyup",w),c.unbind("click",w),c.unbind("focus",w),O=!1)}function n(a){return a.length?a.length>=F:!0}function o(a){var b="",c=C.slice();return a=a.toString(),angular.forEach(E,function(b){a=a.replace(b,"")}),angular.forEach(a.split(""),function(a){c.length&&c[0].test(a)&&(b+=a,c.shift())}),b}function p(a){var b="",c=B.slice();return angular.forEach(D.split(""),function(d,e){a.length&&e===c[0]?(b+=a.charAt(0)||"_",a=a.substr(1),c.shift()):b+=d}),b}function q(a){var b=d.placeholder;return"undefined"!=typeof b&&b[a]?b[a]:"_"}function r(){return D.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function s(a){var b=0;if(B=[],C=[],D="","string"==typeof a){F=0;var c=!1,d=a.split("");angular.forEach(d,function(a,d){R.maskDefinitions[a]?(B.push(b),D+=q(d),C.push(R.maskDefinitions[a]),b++,c||F++):"?"===a?c=!0:(D+=a,b++)})}B.push(B.slice().pop()+1),E=r(),N=B.length>1?!0:!1}function t(){L=0,M=0,I&&0!==G.length||(H="",c.val(""),a.$apply(function(){e.$setViewValue("")}))}function u(a){"mousedown"===a.type?c.bind("mouseout",v):c.unbind("mouseout",v)}function v(){M=A(this),c.unbind("mouseout",v)}function w(b){b=b||{};var d=b.which,f=b.type;if(16!==d&&91!==d){var g,h=c.val(),i=J,j=o(h),k=K,l=!1,m=y(this)||0,n=L||0,q=m-n,r=B[0],s=B[j.length]||B.slice().shift(),t=M||0,u=A(this)>0,v=t>0,w=h.length>i.length||t&&h.length>i.length-t,C=h.length<i.length||t&&h.length===i.length-t,D=d>=37&&40>=d&&b.shiftKey,E=37===d,F=8===d||"keyup"!==f&&C&&-1===q,G=46===d||"keyup"!==f&&C&&0===q&&!v,H=(E||F||"click"===f)&&m>r;if(M=A(this),!D&&(!u||"click"!==f&&"keyup"!==f)){if("input"===f&&C&&!v&&j===k){for(;F&&m>r&&!x(m);)m--;for(;G&&s>m&&-1===B.indexOf(m);)m++;var I=B.indexOf(m);j=j.substring(0,I)+j.substring(I+1),l=!0}for(g=p(j),J=g,K=j,c.val(g),l&&a.$apply(function(){e.$setViewValue(j)}),w&&r>=m&&(m=r+1),H&&m--,m=m>s?s:r>m?r:m;!x(m)&&m>r&&s>m;)m+=H?-1:1;(H&&s>m||w&&!x(n))&&m++,L=m,z(this,m)}}}function x(a){return B.indexOf(a)>-1}function y(a){if(!a)return 0;if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();return b.moveStart("character",-a.value.length),b.text.length}return 0}function z(a,b){if(!a)return 0;if(0!==a.offsetWidth&&0!==a.offsetHeight)if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}function A(a){return a?void 0!==a.selectionStart?a.selectionEnd-a.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var B,C,D,E,F,G,H,I,J,K,L,M,N=!1,O=!1,P=d.placeholder,Q=d.maxlength,R={};d.uiOptions?(R=a.$eval("["+d.uiOptions+"]"),angular.isObject(R[0])&&(R=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]?angular.extend(b[c],a[c]):b[c]=angular.copy(a[c]));return b}(b,R[0]))):R=b,d.$observe("uiMask",f),d.$observe("placeholder",g),e.$formatters.push(h),e.$parsers.push(i),c.bind("mousedown mouseup",u),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1})}}}}]),angular.module("caseCompApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","ui.select2","ui.mask","angularCharts","ngUpload"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{redirectTo:"/dashboard",authenticate:!0}).when("/dashboard",{templateUrl:"partials/main",controller:"MainCtrl",authenticate:!0}).when("/login",{templateUrl:"partials/login",controller:"LoginCtrl",reverseAuthenticate:!0}).when("/signup",{templateUrl:"partials/signup",controller:"SignupCtrl",authenticate:!0}).when("/offers/:view?/:id",{templateUrl:"partials/publicOfferView",controller:"offersController"}).when("/settings/:page?",{templateUrl:"partials/settings",controller:"SettingsCtrl",authenticate:!0}).when("/analytics",{templateUrl:"partials/analytics",controller:"analyticsController",authenticate:!0}).when("/jobs",{templateUrl:"partials/jobs",controller:"jobsController",authenticate:!0}).when("/jobs/view/:id",{templateUrl:"partials/viewJob",controller:"jobsController",authenticate:!0}).when("/jobs/add",{templateUrl:"partials/addJob",controller:"jobsController",authenticate:!0}).when("/jobs/edit/:id",{templateUrl:"partials/addJob",controller:"jobsController",authenticate:!0}).when("/events",{templateUrl:"partials/events",controller:"eventsController",authenticate:!0}).when("/events/view/:id",{templateUrl:"partials/viewEvent",controller:"eventsController",authenticate:!0}).when("/events/add",{templateUrl:"partials/addEvent",controller:"eventsController",authenticate:!0}).when("/events/edit/:id",{templateUrl:"partials/addEvent",controller:"eventsController",authenticate:!0}).when("/events/view/:id/attendee",{templateUrl:"partials/addAttendee",controller:"eventsController",authenticate:!0}).when("/candidates",{templateUrl:"partials/candidates",controller:"candidatesController",authenticate:!0}).when("/candidates/view/:id",{templateUrl:"partials/viewCandidate",controller:"candidatesController",authenticate:!0}).when("/candidates/add",{templateUrl:"partials/addCandidate",controller:"candidatesController",authenticate:!0}).when("/candidates/edit/:id",{templateUrl:"partials/addCandidate",controller:"candidatesController",authenticate:!0}).when("/candidates/view/:id/interview",{templateUrl:"partials/addInterview",controller:"candidatesController",authenticate:!0}).when("/applicants",{templateUrl:"partials/candidates",controller:"candidatesController",authenticate:!0}).when("/applicants/view/:id",{templateUrl:"partials/viewCandidate",controller:"candidatesController",authenticate:!0}).otherwise({redirectTo:"/dashboard"}),b.html5Mode(!0),c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status||403===c.status?(b.path("/login"),a.reject(c)):a.reject(c)}}}])}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(d,e){e.authenticate&&!c.isLoggedIn()?b.path("/login"):e.reverseAuthenticate&&c.isLoggedIn()?b.path("/dashboard"):(a.offerViewer="offers"===b.path().split("/")[1]?!0:!1,NProgress.start(),$(".navbar-collapse").hasClass("in")&&$(".navbar-toggle").click())}),a.$on("$routeChangeSuccess",function(){NProgress.done()})}]),$(function(){FastClick.attach(document.body)}),angular.module("caseCompApp").controller("MainCtrl",["$scope","$http","Jobs","Candidates","Events",function(a,b,c,d,e){a.jobs=[],a.candidates=[],a.events=[],c.list(function(b){a.jobs=b.jobs.slice(0,3)}),d.list(function(b){a.candidates=b.candidates.slice(0,3)}),e.list(function(b){a.events=b.events.slice(0,3)})}]),angular.module("caseCompApp").controller("NavbarCtrl",["$scope","$rootScope","$location","Auth",function(a,b,c,d){a.user={},b.$watch("currentUser",function(){a.user=b.currentUser}),a.logout=function(){d.logout().then(function(){c.path("/login")})},a.isActive=function(a){return a===c.path().split("/")[1].toLowerCase()}}]),angular.module("caseCompApp").controller("LoginCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors.other=b.message})}}]),angular.module("caseCompApp").controller("SignupCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.type})})}}]),angular.module("caseCompApp").controller("SettingsCtrl",["$scope","$routeParams","$rootScope","User","Auth",function(a,b,c,d,e){a.errors={},a.Nerrors={},a.user={},a.user.newName=c.currentUser.name,b.page,a.users=[],d.get({id:"list"},function(b){a.users=b.users}),a.changePassword=function(b){a.submitted=!0,b.$valid&&e.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."}).catch(function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password"})},a.changeName=function(b){a.Nsubmitted=!0;var d=a.user.newName;b.$valid&&e.changeName(d).then(function(){a.Nmessage="Name successfully changed.",c.currentUser.name=d}).catch(function(){b.name.$setValidity("mongoose",!1),a.Nerrors.other="Name rejected by server."})}}]),angular.module("caseCompApp").controller("analyticsController",["$scope","Auth","$location","$timeout","Candidates","Events","Jobs",function(a,b,c,d,e,f,g){a.candidatesBySchool={config:{title:"",tooltips:!1,labels:!1,legend:{display:!0,position:"right"}},data:{series:[],data:[]}},a.averageGPA={config:{title:"",tooltips:!1,labels:!1,legend:{display:!1,position:"right"}},data:{series:[],data:[]}},a.topMajors={config:{title:"",tooltips:!1,labels:!1,legend:{display:!0,position:"right"}},data:{series:[],data:[]}},a.offersBySchool={config:{title:"",tooltips:!1,labels:!1,legend:{display:!0,position:"right"}},data:{series:[],data:[]}},g.list(function(b){var c={};_.each(b.jobs,function(a){_.each(a.offers,function(a){_.each(a.candidate.university,function(a){c[a]||(c[a]=0),c[a]++})})});var d=_.pairs(c);d.sort(function(a,b){return a[1]>b[1]?-1:a[1]===b[1]?0:1});var e=a.offersBySchool.data;_.each(d,function(a){e.series.push(a[0]),e.data.push({x:a[0],y:[a[1]]})})}),e.list(function(b){var c={},d={};_.each(b.candidates,function(a){_.each(a.university,function(b){c[b]||(c[b]={gpa:[],count:0}),a.GPA&&c[b].gpa.push(a.GPA),c[b].count++}),_.each(a.major,function(a){d[a]||(d[a]=0),d[a]++})});var e=_.pairs(c),f=_.pairs(c),g=_.pairs(d);e.sort(function(a,b){return a[1].count>b[1].count?-1:a[1].count===b[1].count?0:1}),_.each(f,function(a){for(var b=0,c=0;c<a[1].gpa.length;c++)b+=a[1].gpa[c];a[1].average=b/a[1].gpa.length}),f.sort(function(a,b){return a[1].average>b[1].average?-1:a[1].average===b[1].average?0:1}),g.sort(function(a,b){return a[1]>b[1]?-1:a[1]===b[1]?0:1});var h=a.candidatesBySchool.data;_.each(e,function(a){h.series.push(a[0]),h.data.push({x:a[0],y:[a[1].count]})});var i=a.averageGPA.data;_.each(f,function(a){i.series.push(a[0]),i.data.push({x:a[0],y:[a[1].average]})});var j=a.topMajors.data;_.each(g,function(a){j.series.push(a[0]),j.data.push({x:a[0],y:[a[1]]})})}),a.chart=[{labels:["Monday","Tuesday","Wednesday","Thursday","Friday"],datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#e67e22",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:[4,3,5,4,6]},{fillColor:"rgba(151,187,205,0)",strokeColor:"#f1c40f",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#f1c40f",data:[8,3,2,5,4]}]},{labels:["Monday","Tuesday","Wednesday","Thursday","Friday"],datasets:[{fillColor:"#f1c40f",strokeColor:"#f1c40f",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[7,3,4,6,7]},{fillColor:"#FF0000",strokeColor:"#e67e22",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[0,3,4,6,1]}]},{labels:["Monday","Tuesday","Wednesday","Thursday","Friday"],datasets:[{fillColor:"#f1c40f",strokeColor:"#f1c40f",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[7,3,4,6,7]},{fillColor:"#FF0000",strokeColor:"#e67e22",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:[0,3,4,6,1]}]},[{value:30,color:"#D97041"},{value:90,color:"#C7604C"},{value:24,color:"#21323D"},{value:58,color:"#9D9B7F"},{value:82,color:"#7D4F6D"},{value:8,color:"#584A5E"}]],a.options={segmentShowStroke:!1}}]),angular.module("caseCompApp").controller("candidatesController",["$scope","Candidates","Applicants","$location","$routeParams","$modal",function(a,b,c,d,e,f){a.edit=!1,a.candidates=[],a.um={},a.udm={},a.applicants="applicants"===d.path().split("/")[1];var g=b;a.applicants&&(g=c),a.startUploading=function(){console.log("uploading....")},a.uploadComplete=function(b){console.log(b),a.response=b,a.response.style={color:a.response.color,"font-weight":"bold"},a.fullname="",a.gender="",a.color=""},a.sortMode="name",a.sortString="Name",a.sortDesc=!1,a.sortBackwards=!1,a.searchMode="all",a.searchString="All",e.id&&(a.edit=!0);var h=function(){NProgress.start(),a.edit?g.get({id:e.id},function(b){NProgress.done(),console.log(b),b.applicant&&!a.applicants?d.path("/applicants/view/"+b._id):!b.applicant&&a.applicants?d.path("/candidates/view/"+b._id):a.um=b},function(){NProgress.done(),d.path("/candidates")}):g.list(function(b){NProgress.done(),_.forEach(b.candidates,function(a){a.name=a.firstName+" "+a.lastName}),a.candidates=b.candidates})};a.deArray=function(a,b){return _.isArray(a)?b?a[0]:a.join(", "):a},h(),a.pickRelevant=function(b){var c=a.sortMode.toLowerCase();("name"===c||"firstname"===c)&&(c="");var d=c||(b.matched||"").toLowerCase()||"name";return"name"===d||"firstname"===d?b.university:"gpa"===d?b.GPA+" GPA"||b.university||"":b[d]||b.university||""},a.swapSortDirection=function(){a.sortDesc=!a.sortDesc},a.setSort=function(b,c,d){a.sortMode=b,a.sortString=c,a.sortBackwards=d||!1},a.getSortDesc=function(){return a.sortBackwards?!a.sortDesc:a.sortDesc},a.clearSearch=function(){a.searchMode="all",a.searchString="All",a.search=""},a.setSearch=function(b,c){a.searchMode=b,a.searchString=c},a.deleteClicked=function(){var b=f.open({templateUrl:"partials/deleteModal.html",controller:"DeleteModalController",resolve:{type:function(){return"Candidate"},name:function(){return a.um.firstName+" "+a.um.lastName}}});b.result.then(function(a){"yes"===a&&(NProgress.start(),g.delete({id:e.id},function(){NProgress.done(),d.path("/candidates")},function(a){console.log(a),NProgress.done(),alert("An unknown error occured while deleting the candidate.")}))},function(){})},a.upgradeCandidate=function(){a.applicants&&(NProgress.start(),a.um.applicant=!1,g.update(a.um,function(a){NProgress.done(),"O"===a[0]?d.path("/candidates"):alert("An error occured while upgrading applicant.")}))},a.downgradeCandidate=function(){a.applicants||(NProgress.start(),a.um.applicant=!0,g.update(a.um,function(a){NProgress.done(),"O"===a[0]?d.path("/applicants"):alert("An error occured while upgrading applicant.")}))},a.formatPhone=function(a){return a?a.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):""},a.addClicked=function(){NProgress.start();var b={};a.applicants&&(b.applicant=!0);var c=f.open({templateUrl:"partials/addCandidate.html",controller:"ModalController",resolve:{ForcedData:function(){return{prepare:function(a){a.GPA>9&&(a.GPA=parseInt((a.GPA+"000").substring(0,3))/100)},mixin:b}}}});c.result.then(function(){h()},function(){})},a.showInterview=function(){var c=f.open({templateUrl:"partials/addInterview.html",controller:"ModalController",resolve:{ForcedData:function(){return{noedit:!0,datetime:!0,mode:"candidates",title:"Interview",upload:function(c,d){c._id=a.um._id,c.id="interview",b.interview(c,d)}}}}});c.result.then(function(){h()},function(){})},a.addInterview=function(){a.udm._id=a.um._id,g.interview(a.udm,function(){d.path("/candidates/view/"+a.um._id)})},a.addCandidate=function(){a.edit?g.update(a.um,function(){d.path("/candidates/view/"+a.um._id)},function(a){console.log(a),alert("An error occured while saving.")}):g.save(a.um,function(){d.path("/candidates")},function(a){console.log(a),alert("An error occured while saving.")})}}]),angular.module("caseCompApp").controller("eventsController",["$scope","Events","$modal","$location","$routeParams","$sce","$timeout",function(a,b,c,d,e,f,g){a.edit=!1,a.events=[],a.um={},a.sortMode="name",a.sortString="Name",a.sortDesc=!1,a.sortBackwards=!1,a.searchMode="all",a.searchString="All",a.mapUrl="",e.id&&(a.edit=!0),a.fmtDate=function(a){return a&&moment(a)?moment(a).format("MMMM Do, YYYY"):a},a.updateMap=function(){g(function(){a.mapUrl=f.trustAsResourceUrl("http://maps.google.com/maps?q="+a.prepAddr(a.um.address)+"&zoom=20&output=embed&t="+Math.random())},0)};var h=function(){NProgress.start(),a.edit?b.get({id:e.id},function(b){NProgress.done(),a.um=b,a.mapUrl=f.trustAsResourceUrl("http://maps.google.com/maps?q="+a.prepAddr(a.um.address)+"&zoom=20&output=embed")},function(){NProgress.done(),d.path("/events")}):b.list(function(b){NProgress.done(),a.events=b.events})};a.deArray=function(a,b){return _.isArray(a)?b?a[0]:a.join(", "):a},h(),a.pickRelevant=function(b){var c=a.sortMode.toLowerCase();"name"===c&&(c="");var d=c||(b.matched||"").toLowerCase()||"name";return"name"===d?b.university:"datetime"===d||"date"===d?moment(b.datetime).format("MMMM Do, YYYY")||candidate.university||"":b[d]||b.university||""},a.swapSortDirection=function(){a.sortDesc=!a.sortDesc},a.setSort=function(b,c,d){a.sortMode=b,a.sortString=c,a.sortBackwards=d||!1},a.getSortDesc=function(){return a.sortBackwards?!a.sortDesc:a.sortDesc},a.clearSearch=function(){a.searchMode="all",a.searchString="All",a.search=""},a.setSearch=function(b,c){a.searchMode=b,a.searchString=c},a.prepAddr=function(a){return a.replace(" ","")},a.addClicked=function(){NProgress.start();var a=c.open({templateUrl:"partials/addEvent.html",controller:"ModalController",resolve:{ForcedData:function(){return{usersMultiple:!0}}}});a.result.then(function(){h()},function(){})},a.addAttendee=function(){a.udm._id=a.um._id,b.attendee(a.udm,function(){d.path("/events/view/"+a.um._id)})},a.deleteClicked=function(){var f=c.open({templateUrl:"partials/deleteModal.html",controller:"DeleteModalController",resolve:{type:function(){return"Event"},name:function(){return a.um.name}}});f.result.then(function(a){"yes"===a&&(NProgress.start(),b.delete({id:e.id},function(){NProgress.done(),d.path("/events")},function(a){console.log(a),NProgress.done(),alert("An unknown error occured while deleting the event.")}))},function(){})},a.addEvent=function(){a.edit?b.update(a.um,function(){d.path("/events/view/"+a.um._id)},function(a){console.log(a),alert("An error occured while saving.")}):b.save(a.um,function(){d.path("/events")},function(a){console.log(a),alert("An error occured while saving.")})}}]),angular.module("caseCompApp").controller("jobsController",["$scope","Jobs","$location","$routeParams","$modal",function(a,b,c,d,e){a.edit=!1,a.jobs=[],a.jobModel={},a.sortMode="name",a.sortString="Name",a.sortDesc=!1,a.sortBackwards=!1,a.searchMode="all",a.searchString="All",d.id&&(a.edit=!0);var f=function(){NProgress.start(),a.edit?b.get({id:d.id},function(b){NProgress.done(),console.log(b),_.each(b.applicants,function(a){a.statusInt=1,"declined"===a.status.toLowerCase()?a.statusInt=0:"rejected"===a.status.toLowerCase()?a.statusInt=-1:"offered"===a.status.toLowerCase()?a.statusInt=2:"accepted"===a.status.toLowerCase()&&(a.statusInt=3)}),a.jobModel=b},function(){NProgress.done(),c.path("/jobs")}):b.list(function(b){NProgress.done(),_.each(b.jobs,function(a){a.statusInt=3,"pending"===a.status.toLowerCase()?a.statusInt=2:"filled"===a.status.toLowerCase()&&(a.statusInt=1)}),a.jobs=b.jobs})};f(),a.deArray=function(a,b){return _.isArray(a)?b?a[0]:a.join(", "):a},a.pickRelevant=function(b){var c=a.sortMode.toLowerCase();"name"===c&&(c="");var d=c||(b.matched||"").toLowerCase()||"name";return"name"===d?b.location:b[d]||b.location||""},a.swapSortDirection=function(){a.sortDesc=!a.sortDesc},a.setSort=function(b,c,d){a.sortMode=b,a.sortString=c,a.sortBackwards=d||!1},a.getSortDesc=function(){return a.sortBackwards?!a.sortDesc:a.sortDesc},a.clearSearch=function(){a.searchMode="all",a.searchString="All",a.search=""},a.setSearch=function(b,c){a.searchMode=b,a.searchString=c},a.getSortModeString=function(){var b=a.getSortDesc()?"-":"";return b+=a.sortMode},a.deleteClicked=function(){var f=e.open({templateUrl:"partials/deleteModal.html",controller:"DeleteModalController",resolve:{type:function(){return"Job"},name:function(){return a.jobModel.name}}});f.result.then(function(a){"yes"===a&&(NProgress.start(),b.delete({id:d.id},function(){NProgress.done(),c.path("/jobs")},function(a){console.log(a),NProgress.done(),alert("An unknown error occured while deleting the job.")}))},function(){})},a.addClicked=function(){NProgress.start();var a=e.open({templateUrl:"partials/addJob.html",controller:"ModalController",resolve:{ForcedData:function(){return{restore:function(a){a.visibility=a.visible?"Public":"Private"}}}}});a.result.then(function(){f()},function(){})},a.editApplicant=function(c){NProgress.start();var d=e.open({templateUrl:"partials/addJobApplicant.html",controller:"ModalController",resolve:{ForcedData:function(){return{title:"Job Applicant",mode:"JA",noedit:!0,edit:!0,defaultData:_.cloneDeep(c),upload:function(c,d){var e=_.cloneDeep(c);e.candidate=c.candidate._id,e.job=a.jobModel._id,b.applicant(e,function(a,b){console.log(a,b),d()})}}}}});d.result.then(function(){f()},function(){})},a.addApplicant=function(){NProgress.start();var c=e.open({templateUrl:"partials/addJobApplicant.html",controller:"ModalController",resolve:{ForcedData:function(){return{title:"Job Applicant",mode:"JA",noedit:!0,edit:!1,defaultData:{status:"Pending"},upload:function(c,d){var e=_.cloneDeep(c);e.candidate=c.candidate._id,e.job=a.jobModel._id,b.applicant(e,function(){d()})}}}}});c.result.then(function(){f()},function(){})},a.createOffer=function(){NProgress.start();var c=e.open({templateUrl:"partials/addJobOffer.html",controller:"ModalController",resolve:{ForcedData:function(){return{title:"Job Offer",mode:"JO",noedit:!0,edit:!1,defaultData:{status:"Sent",emailToCandidate:!0,changeJobStatus:!0,autoReject:!0,emailRejected:!0,rejectedEmailText:"We are sorry to inform you that we are currently unable to offer you a position at our firm. Thank you for your time and interest.",offerText:"Congratulations, we are happy to offer you a position at our firm. Please indicate whether or not you accept our offer."},upload:function(c,d){var e=_.cloneDeep(c);e.candidateEmail=c.candidate.email,e.candidate=c.candidate._id,e.job=a.jobModel._id,b.offer(e,function(){d()})}}}}});c.result.then(function(){f()},function(){})},a.editOffer=function(c){NProgress.start();var d=e.open({templateUrl:"partials/addJobOffer.html",controller:"ModalController",resolve:{ForcedData:function(){return{title:"Job Offer",mode:"JO",noedit:!0,edit:!0,defaultData:_.cloneDeep(c),upload:function(c,d){var e=_.cloneDeep(c);e.candidateEmail=c.candidate.email,e.candidate=c.candidate._id,e.job=a.jobModel._id,b.offer(e,function(){d()})}}}}});d.result.then(function(){f()},function(){})}}]),angular.module("caseCompApp").controller("offersController",["$scope","$routeParams","$rootScope","$location","Jobs",function(a,b,c,d,e){c.offerViewer=!0,a.offer={},a.actioned=!1,e.viewOffer({offer:b.id},function(c){a.offer=c.offer.offers[0],("Accepted"===a.offer.status||"Declined"===a.offer.status)&&(a.actioned=!0),(b.view&&"v"===b.view&&"Sent"===a.offer.status||"Pending"===a.offer.status)&&e.get({id:"offerStatus",offer:b.id,status:"Viewed"},function(){})}),a.accept=function(){a.actioned=!0,a.acc=!0,a.offer.status="Accepted",e.get({id:"offerStatus",offer:b.id,status:"Accepted"},function(){})},a.decline=function(){a.actioned=!0,a.dec=!0,a.offer.status="Declined",e.get({id:"offerStatus",offer:b.id,status:"Declined"},function(){})}}]),angular.module("caseCompApp").controller("ModalController",["$scope","$routeParams","$location","$timeout","$modalInstance","ForcedData","Applicants","Candidates","Events","Jobs",function(a,b,c,d,e,f,g,h,i,j){f=f||{},a.model={};var k={candidates:h,applicants:g,events:i,jobs:j},l=f.mode||c.path().split("/")[1],m=k[l];a.edit=!1,b.id&&!f.noedit?(a.edit=!0,m.get({id:b.id},function(b){"events"===l&&(_.each(b.attendees,function(a){a.id=a._id}),_.each(b.hosts,function(a){a.id=a._id,a.text=a.name})),NProgress.done(),a.model=b,f.restore&&f.restore(a.model)},function(){NProgress.done(),e.dismiss("cancel")})):(_.extend(a.model,f.defaultData||{}),NProgress.done()),f&&"boolean"==typeof f.edit&&(a.edit=f.edit),f&&f.datetime&&(a.model.datetime=a.model.datetime||new Date),a.label=function(b){var c=b||f.title||l.charAt(0).toUpperCase()+l.slice(1).substring(0,l.length-2);return a.edit?"Edit "+c:"Add "+c},a.add=function(){NProgress.start(),_.extend(a.model,f.mixin||{}),f.prepare&&f.prepare(a.model),f.upload?f.upload(a.model,function(){NProgress.done(),e.close("ok")}):a.edit?m.update(a.model,function(){NProgress.done(),e.close("ok")},function(a){NProgress.done(),console.log(a),alert("An error occured while saving.")}):m.save(a.model,function(){NProgress.done(),e.close("ok")},function(a){NProgress.done(),console.log(a),alert("An error occured while saving.")})},a.openDate=function(a){a.preventDefault(),a.stopPropagation(),d(function(){$(a.target).closest(".datepick").find("input").focus()})},a.cancel=function(){e.dismiss("cancel")},a.inputUniversities={multiple:!0,simple_tags:!0,tags:["DePauw University","Indiana University","Michigan State University","Northwestern University","Ohio State University","Pennsylvania State University","Purdue University","University of Chicago","University of Illinois","University of Iowa","University of Michigan","University of Minnesota","University of Nebraska-Lincoln","University of Wisconsin"]},a.inputMajors={multiple:!0,simple_tags:!0,tags:["Accounting","Aerospace Engineering","Agricultural and Biological Engineering","Bioengineering","Business Process Management","Chemical and Biomolecular Engineering","Chemical Engineering","Civil and Environmental Engineering","Computational Science and Engineering","Computer Science","Electrical and Computer Engineering","Finance","Industrial and Enterprise Systems Engineering","Information Systems and Information Technology","Management: General","Management: International Business","Marketing","Materials Science and Engineering","Mechanical Science and Engineering","Nuclear, Plasma, and Radiological Engineering","Physics","Supply Chain Management","Other"]},a.inputMinors={multiple:!0,simple_tags:!0,tags:["Bioengineering","Business","Chemistry","Computer Science","Material Science and Engineering","Mathematics","Molecular Biology","Physics","Statistics","Technology and Management","Other"]},a.queryUsersOptions={multiple:f.usersMultiple||!1,ajax:{url:"/api/users/search",data:function(a){return{q:a}},results:function(a){var b=_.map(a.users,function(a){return{id:a._id,text:a.name||a.email}});return{results:b}}}},a.queryCandidateOptions={multiple:f.usersMultiple||!1,ajax:{url:"/api/candidates/search",data:function(a){return{q:a}},results:function(a){return _.each(a.candidates,function(a){a.id=a._id}),{results:a.candidates}}},formatResult:function(a){var b="<div class='candidate-search-result'>";return b+="<strong>"+a.firstName+" "+a.lastName+"</strong><br />",b+="<span>"+a.university.join(", ")+"</span>",b+="<span>"+a.major.join(", ")+"</span>",b+="<span>GPA: "+a.GPA+"</span>",b+="</div>"},dropdownCssClass:"bigdrop",escapeMarkup:function(a){return a},formatSelection:function(a){return a.firstName+" "+a.lastName}}}]),angular.module("caseCompApp").controller("DeleteModalController",["$scope","$modalInstance","type","name",function(a,b,c,d){a.name=d,a.type=c,a.ok=function(){b.close("yes")},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("caseCompApp").factory("Auth",["$location","$rootScope","Session","User","$cookieStore",function(a,b,c,d,e){return b.currentUser=e.get("user")||null,e.remove("user"),{login:function(a,d){var e=d||angular.noop;return c.save({email:a.email,password:a.password},function(a){return b.currentUser=a,e()},function(a){return e(a)}).$promise},logout:function(a){var d=a||angular.noop;return c.delete(function(){return b.currentUser=null,d()},function(a){return d(a)}).$promise},createUser:function(a,c){var e=c||angular.noop;return d.save(a,function(a){return b.currentUser=a,e(a)},function(a){return e(a)}).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.update({id:"pass",oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},changeName:function(a,b){var c=b||angular.noop;return d.update({id:"name",name:a},function(a){return c(a)},function(a){return c(a)}).$promise},currentUser:function(){return d.get()},isLoggedIn:function(){var a=b.currentUser;return!!a}}}]),angular.module("caseCompApp").factory("Session",["$resource",function(a){return a("/api/session/")}]),angular.module("caseCompApp").factory("User",["$resource",function(a){return a("/api/users/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("caseCompApp").factory("Candidates",["$resource",function(a){return a("/api/candidates/:id",{id:"@id"},{list:{method:"GET",params:{}},update:{method:"PUT",params:{}},get:{method:"GET",params:{}},interview:{method:"GET",params:{id:"interview"}}})}]),angular.module("caseCompApp").factory("Applicants",["$resource",function(a){return a("/api/applicants/:id",{id:"@id"},{list:{method:"GET",params:{}},update:{method:"PUT",params:{}},get:{method:"GET",params:{}},interview:{method:"GET",params:{id:"interview"}}})}]),angular.module("caseCompApp").factory("Jobs",["$resource",function(a){return a("/api/jobs/:id",{id:"@id"},{list:{method:"GET",params:{}},applicant:{method:"GET",params:{id:"applicant"}},offer:{method:"POST",params:{id:"offer"}},viewOffer:{method:"GET",params:{id:"offer"}},update:{method:"PUT",params:{}},get:{method:"GET",params:{}}})}]),angular.module("caseCompApp").factory("Events",["$resource",function(a){return a("/api/events/:id",{id:"@id"},{list:{method:"GET",params:{}},update:{method:"PUT",params:{}},get:{method:"GET",params:{}},attendee:{method:"GET",params:{id:"attendee"}}})}]),angular.module("caseCompApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("caseCompApp").directive("basicTile",function(){return{restrict:"AE",scope:{icon:"=",header:"=",details:"=",edit:"=",edited:"&"},replace:!0,templateUrl:"partials/basicTile.html",link:function(a,b,c){c.mode&&"add"===c.mode&&(b.addClass("add"),b.html('<span class="fa fa-plus"></span>'));var d={event:"calendar",job:"suitcase",candidate:"user"};a.deArray=function(a){return _.isArray(a)?a.join(", "):a},a.editClicked=function(b){b.preventDefault(),b.stopPropagation(),a.edited()},a.$watch("icon",function(){a.picon="fa-"+d[a.icon]})}}});var searchString=function(a,b){return a=a||"",_.isArray(a)&&(a=a.join(", ")),a.toLowerCase().indexOf(b.toLowerCase())>=0};angular.module("caseCompApp").filter("megaFilter",function(){return function(a,b){if(angular.forEach(a,function(a){a.matched=""
}),!b||!b.query)return a;var c=b.query||"",d=b.type||"all",e=[];return angular.forEach(a,function(a){return"name"!==d&&"all"!==d||!searchString(a.name,c)?"university"!==d&&"all"!==d||!searchString(a.university,c)?"major"!==d&&"all"!==d||!searchString(a.major,c)?"minor"!==d&&"all"!==d||!searchString(a.minor,c)?("gpa"===d||"all"===d)&&+c<=+a.GPA?(a.matched="GPA",void e.push(a)):void 0:(a.matched="minor",void e.push(a)):(a.matched="major",void e.push(a)):(a.matched="university",void e.push(a)):(a.matched="name",void e.push(a))}),e}}).filter("megaJobsFilter",function(){return function(a,b){if(angular.forEach(a,function(a){a.matched=""}),!b||!b.query)return a;var c=b.query||"",d=b.type||"all",e=[];return angular.forEach(a,function(a){if(("name"===d||"all"===d)&&searchString(a.name,c))return a.matched="name",void e.push(a);if(("description"===d||"all"===d)&&searchString(a.description,c))return a.matched="description",void e.push(a);if(("location"===d||"all"===d)&&searchString(a.location,c))return a.matched="location",void e.push(a);if(("type"===d||"all"===d)&&searchString(a.type,c))return a.matched="type",void e.push(a);if("salary"===d||"all"===d){"$"===c.charAt(0)&&(c=c.substring(1));var b=a.salary||0;if(+b>=+c)return a.matched="salary",void e.push(a)}}),e}}).filter("megaEventsFilter",function(){return function(a,b){if(angular.forEach(a,function(a){a.matched=""}),!b||!b.query)return a;var c=b.query||"",d=b.type||"all",e=[];return angular.forEach(a,function(a){if(("name"===d||"all"===d)&&searchString(a.name,c))return a.matched="name",void e.push(a);if(("university"===d||"all"===d)&&searchString(a.university,c))return a.matched="university",void e.push(a);if(("type"===d||"all"===d)&&searchString(a.type,c))return a.matched="type",void e.push(a);if("date"===d||"all"===d){var b=chrono.parseDate(c);if(b){b=moment(b).startOf("day");var f=moment(a.datetime).startOf("day");if(f.isAfter(b)||f.isSame(b))return a.matched="date",void e.push(a)}}}),e}});